<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>X-Wing Probability Calculator</title>
  <link rel="stylesheet" href="./jquery-ui/jquery-ui.css">
  <script src="./jquery-2.1.3.min.js"></script>
  <script src="./jquery-ui/jquery-ui.min.js"></script>
</head>
<body>

X-Wing Miniatures Game<br>
Probability Calculator Tabajara (by Hunter Vatto)<br>
<br>

<input type="checkbox" class="check" id="checkboxRollType"><label for="checkboxRollType">Attack</label>
<input type="checkbox" class="check" id="checkbox1"><label for="checkbox1">Not using focus</label>
<input type="checkbox" class="check" id="checkbox2"><label for="checkbox2">Not using target lock</label>

<br>
Dices: <input class="spinner" id="spinnerHit"><br>

<button id="calcButton">Calculate</button><br><br>
<div id="res2"></div>


<script>
function factorial(n) {
	var res=1;	
	for (i=2;i<n+1;i++){
		res*=i;
	}
	return res;
}

function pbinomial(k,n, p) {
	comb= factorial(n)/(factorial(n-k)*factorial(k));
	return comb*Math.pow(p,k)*Math.pow(1-p,n-k);
}

function calcProb() {
	var n=$("#spinnerHit").spinner("value");
	//var n=$("#spinnerMiss").spinner("value")+k;
	
	var p=0.5;
	var title="Hits";
	if ($("#checkboxRollType").is(':checked')==true) {
		p=3/8;
		title="Evades";
	}	
	if ($("#checkbox1").is(':checked')==true) {	
		p+=0.25;
	} 
	if ($("#checkbox2").is(':checked')==true) {
		p=1-(1-p)*(1-p);
	}
	//$("#res2").text(pbinomial(k,n,p)*100+'%');

	
	//computes probabilities	
	var res=calcProbArray(n,p);
	
	//creates output table
	$("#res2").empty();
	$("#res2").append("<table>");
	$("#res2").append("<tr><td>"+title+"</td><td>Probability</td></tr>");
	for (i in res) {
		$("#res2").append("<tr><td>"+i+"</td><td>"+res[i]+"</td></tr>");	
	}
	$("#res2").append("</table>");
}

function calcProbArray(n,p) {
	var res=[];
	for (var i=0; i<(n+1); i++){
		var prob=pbinomial(i,n,p);
		res.push((prob*100).toFixed(2)+"%");
		//alert(i+", "+n+", "+p+": "+prob);
	}
	return res;
}

//Sets all spinners min max 
$( ".spinner" ).spinner({max: 20, min: 0}).val(3);

//set these guys as buttons
$( ".check,#calcButton" ).button();

$("#checkboxRollType").button().click(function () {
    var text = '';
    if ($(this).is(':checked')) {
    	text="Defense";
    	$("#checkbox2").prop("checked", false);
    	$("#checkbox2").button('option','disabled',true);
    } else {
    	text="Attack";
    	$("#checkbox2").button('option','disabled',false);
    }
    $(this).button('option', 'label', text);
});

$("#checkbox1").button().click(function () {
    var text = $(this).is(':checked')? "Using focus": "Not using focus";
    $(this).button('option', 'label', text);
});

$("#checkbox2").button().click(function () {
    var text = $(this).is(':checked')? "Using target lock": "Not using target lock";
    $(this).button('option', 'label', text);
});

$( "#calcButton" ).button().click(function() {
	calcProb();
});

</script>
 
</body>
</html>